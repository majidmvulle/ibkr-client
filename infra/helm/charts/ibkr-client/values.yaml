# Default values for ibkr-client.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

replicaCount: 1

image:
  repository: ghcr.io/majidmvulle/ibkr-client
  pullPolicy: IfNotPresent
  tag: "" # Overrides the image tag whose default is the chart appVersion.

migrations:
  image:
    repository: ghcr.io/majidmvulle/ibkr-client-migrations
    pullPolicy: IfNotPresent
    tag: "latest"

ibkrGateway:
  image:
    repository: ghcr.io/majidmvulle/ibkr-gateway
    pullPolicy: IfNotPresent
    tag: "latest"
  port: 5000

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

serviceAccount:
  create: true
  automount: true
  annotations: {}
  name: ""

podAnnotations: {}
podLabels: {}

podSecurityContext:
  runAsNonRoot: true
  runAsUser: 1000
  fsGroup: 1000

securityContext:
  allowPrivilegeEscalation: false
  capabilities:
    drop:
    - ALL
  readOnlyRootFilesystem: true

service:
  type: ClusterIP
  http:
    port: 8080
    targetPort: 8080
  grpc:
    port: 50051
    targetPort: 50051
  # For k3s homelab, use ClusterIP and access via:
  # - kubectl port-forward
  # - Existing ingress controller
  # - Service mesh

resources:
  limits:
    cpu: 500m
    memory: 512Mi
  requests:
    cpu: 100m
    memory: 128Mi

ibkrGatewayResources:
  limits:
    cpu: 200m
    memory: 256Mi
  requests:
    cpu: 50m
    memory: 64Mi

autoscaling:
  enabled: false
  minReplicas: 1
  maxReplicas: 10
  targetCPUUtilizationPercentage: 80
  targetMemoryUtilizationPercentage: 80

volumes: []
volumeMounts: []

nodeSelector: {}

tolerations: []

affinity: {}

# Application configuration
config:
  appName: "ibkr-client"
  appEnv: "production"
  appDebug: false
  appVersion: "0.1.0"
  httpPort: 8080
  grpcPort: 50051
  logLevel: 0
  dbLogLevel: 2
  ibkrGatewayURL: "http://localhost:5000"
  mtlsEnabled: false
  otelCollectorEndpoint: ""

# Secrets (should be overridden in values-{env}.yaml or via external secrets)
secrets:
  # Database connection strings
  dbWriteDSN: ""
  dbReadDSN: ""
  # 32-byte encryption key for session tokens (base64 encoded)
  encryptionKey: ""
  # IBKR account ID
  ibkrAccountID: ""
  # mTLS certificates (if enabled)
  mtlsCACert: ""
  mtlsServerCert: ""
  mtlsServerKey: ""
  ibkrGatewayKey: ""

# External secrets configuration (optional)
externalSecrets:
  enabled: false
  backend: vault
  vaultPath: secret/data/ibkr-client
